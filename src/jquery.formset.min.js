!function(e){e.fn.formset=function(a){var s=e.extend({},e.fn.formset.defaults,a),t=s.extraClasses.join(" "),r=e("#id_"+s.prefix+"-TOTAL_FORMS"),d=e("#id_"+s.prefix+"-MAX_NUM_FORMS"),i=e("#id_"+s.prefix+"-MIN_NUM_FORMS"),l="input,select,textarea,label,div",n=e(this),o=function(e,a){s.extraClasses&&(e.removeClass(t),e.addClass(s.extraClasses[a%s.extraClasses.length]))},f=function(e,a,s){var t=RegExp(a+"-(\\d+|__prefix__)-"),r=a+"-"+s+"-";e.attr("for")&&e.attr("for",e.attr("for").replace(t,r)),e.attr("id")&&e.attr("id",e.attr("id").replace(t,r)),e.attr("name")&&e.attr("name",e.attr("name").replace(t,r))},m=function(){return 0==d.length||""==d.val()||d.val()-r.val()>0},C=function(){return 0==i.length||""==i.val()||r.val()-i.val()>0},c=function(a){var t=e.trim(s.deleteCssClass).replace(/\s+/g,"."),d=e.trim(s.addCssClass).replace(/\s+/g,"."),i='<a class="'+s.deleteCssClass+'" href="javascript:void(0);">'+s.deleteText+"</a>";s.deleteContainerClass?a.find('[class*="'+s.deleteContainerClass+'"]').append(i):a.is("TR")?a.children(":last").append(i):a.is("UL")||a.is("OL")?a.append("<li>"+i+"</li>"):a.append(i),C()||a.find("a."+t).hide(),a.find("a."+t).click(function(){var a,i=e(this).parents("."+s.formCssClass),n=i.find('input:hidden[id $= "-DELETE"]'),c=i.siblings("a."+d+", ."+s.formCssClass+"-add");n.length?(n.val("on"),i.hide(),a=e("."+s.formCssClass).not(":hidden")):(i.remove(),a=e("."+s.formCssClass).not(".formset-custom-template"),r.val(a.length));for(var p=0,h=a.length;p<h;p++)o(a.eq(p),p),n.length||a.eq(p).find(l).each(function(){f(e(this),s.prefix,p)});return C()||e("a."+t).each(function(){e(this).hide()}),c.is(":hidden")&&m()&&c.show(),s.removed&&s.removed(i),!1})};n.each(function(a){var t,r=e(this),d=r.find('input:checkbox[id $= "-DELETE"]');d.length&&(d.is(":checked")?(d.before('<input type="hidden" name="'+d.attr("name")+'" id="'+d.attr("id")+'" value="on" />'),r.hide()):d.before('<input type="hidden" name="'+d.attr("name")+'" id="'+d.attr("id")+'" />'),e('label[for="'+d.attr("id")+'"]').hide(),d.remove()),(t=r).find(l).length>0&&(r.addClass(s.formCssClass),c(r),o(r,a))});var p,h,u=!m();s.formTemplate?((h=s.formTemplate instanceof e?s.formTemplate:e(s.formTemplate)).removeAttr("id").addClass(s.formCssClass+" formset-custom-template"),h.find(l).each(function(){f(e(this),s.prefix,"__prefix__")}),c(h)):(s.hideLastAddForm&&e("."+s.formCssClass+":last").hide(),(h=e("."+s.formCssClass+":last").clone(!0).removeAttr("id")).find('input:hidden[id $= "-DELETE"]').remove(),h.find(l).not(s.keepFieldValues).each(function(){var a=e(this);a.is("input:checkbox")||a.is("input:radio")?a.attr("checked",!1):a.val("")})),s.formTemplate=h;var v='<a class="'+s.addCssClass+'" href="javascript:void(0);">'+s.addText+"</a>";if(s.addContainerClass){var x=e('[class*="'+s.addContainerClass+'"');x.append(v),p=x.find('[class="'+s.addCssClass+'"]')}else if(n.is("TR")){var T=e('<tr><td colspan="'+n.eq(0).children().length+'">'+v+"</tr>").addClass(s.formCssClass+"-add");n.parent().append(T),p=T.find("a")}else n.filter(":last").after(v),p=n.filter(":last").next();return u&&p.hide(),p.click(function(){var a=parseInt(r.val()),t=s.formTemplate.clone(!0).removeClass("formset-custom-template"),d=e(e(this).parents("tr."+s.formCssClass+"-add").get(0)||this),i=e.trim(s.deleteCssClass).replace(/\s+/g,".");return o(t,a),t.insertBefore(d).show(),t.find(l).each(function(){f(e(this),s.prefix,a)}),r.val(a+1),C()&&e("a."+i).each(function(){e(this).show()}),m()||d.hide(),s.added&&s.added(t),!1}),n},e.fn.formset.defaults={prefix:"form",formTemplate:e("#empty-form-template"),addText:"add another",deleteText:"remove",addContainerClass:null,deleteContainerClass:null,addCssClass:"add-row",deleteCssClass:"delete-row",formCssClass:"dynamic-form",extraClasses:[],keepFieldValues:"",added:null,removed:null,hideLastAddForm:!1}}(jQuery);
